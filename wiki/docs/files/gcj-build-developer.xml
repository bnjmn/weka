<?xml version="1.0" encoding="UTF-8"?>

<project name="weka.gcj" default="dist" basedir=".">
   <!-- compile options -->
   <property name="build.sysclasspath" value="ignore" />
   <property name="build.compiler"     value="modern" />
   <property name="debug"              value="on" />
   <property name="deprecation"        value="off" />
   <property name="optimization"       value="off" />
   <property name="memory"             value="800m"/>
   <property environment="env"/>

   <!-- directories -->
   <property name="build"    value="build" />
   <property name="retro"    value="build.retro" />
   <property name="dist"     value="dist" />
   <property name="doc"      value="doc" />
   <property name="src"      value="src" />
   <property name="lib"      value="jar" />

   <!-- the 1.4 rt.jar - must be provided with -Drt14=... -->
   <property name="rt14"      value="" />

   <!-- CLASSPATH -->
   <path id="project.class.path">
      <pathelement location="." />
      <fileset dir="${lib}">
         <include name="*.jar"/>
         <include name="*.zip"/>
      </fileset>
   </path>

   <taskdef name="retroweaver" classname="net.sourceforge.retroweaver.ant.RetroWeaverTask">
      <classpath>
         <pathelement location="." />
         <pathelement location="${rt14}" />
         <fileset dir="${lib}">
            <include name="*.jar"/>
            <include name="*.zip"/>
         </fileset>
      </classpath>
   </taskdef>

   <!-- targets -->
   <target name="init" depends="setup, copyFiles" description="Initializes the Project."/>

   <target name="setup" description="Creates the output directories.">
      <tstamp />
      <mkdir dir="${build}" />
      <mkdir dir="${retro}" />
      <mkdir dir="${dist}" />
      <mkdir dir="${doc}" />
   </target>

   <target name="copyFiles" description="Copies files to the ${dist} directory.">
      <copy todir="${dist}">
         <fileset dir="${lib}" includes="*.jar"/>
         <fileset dir="${lib}" includes="*.zip"/>
      </copy>
      <copy todir="${build}">
         <fileset dir="${src}" includes="**/*.gif"/>
         <fileset dir="${src}" includes="**/*.jpg"/>
         <fileset dir="${src}" includes="**/*.png"/>
         <fileset dir="${src}" includes="**/*.props"/>
         <fileset dir="${src}" includes="**/*.txt"/>
         <fileset dir="${src}" includes="**/DatabaseUtils.props.*"/>
         <fileset dir="${src}" includes="**/*.excludes"/>
         <fileset dir="${src}" includes="**/*.html"/>
         <fileset dir="${src}" includes="**/README*"/>
      </copy>
      <copy todir="${retro}">
         <fileset dir="${src}" includes="**/*.gif"/>
         <fileset dir="${src}" includes="**/*.jpg"/>
         <fileset dir="${src}" includes="**/*.png"/>
         <fileset dir="${src}" includes="**/*.props"/>
         <fileset dir="${src}" includes="**/*.txt"/>
         <fileset dir="${src}" includes="**/DatabaseUtils.props.*"/>
         <fileset dir="${src}" includes="**/*.excludes"/>
         <fileset dir="${src}" includes="**/*.html"/>
         <fileset dir="${src}" includes="**/README*"/>
      </copy>
   </target>

   <!-- removeJar -->
   <target name="removeJar" description="Deletes the current jar archive.">
      <delete file="${dist}/weka.jar"/>
   </target>
   
   <target name="removeRemoteJar" description="Deletes the current remote jar archive.">
      <delete file="${dist}/remoteExperimentServer.jar"/>
   </target>
   
   <!-- clean -->
   <target name="clean" depends="removeJar, removeRemoteJar, cleanTmp" description="Removes autogenerated files.">
      <delete failonerror="false">
         <fileset dir="${basedir}" defaultexcludes="no">
            <include name="**/*.class" />
            <include name="**/*.scc" />
            <include name="**/.#*" />
         </fileset>
      </delete>

      <delete dir="${build}" failonerror="false" />
      <delete dir="${retro}" failonerror="false" />
      <delete dir="${dist}" failonerror="false" />
   </target>

   <!-- cleanTmp -->
   <target name="cleanTmp" description="Removes temporary files.">
      <delete failonerror="false">
         <fileset dir="${basedir}" defaultexcludes="no">
            <include name="**/*.scc" />
            <include name="**/*~" />
         </fileset>
      </delete>
   </target>

   <!-- compile -->
   <target name="compile" depends="init" description="Compiles the classes.">
      <echo message="Compiling classes for WEKA." />

      <javac srcdir="${src}" destdir="${build}" optimize="${optimization}" 
             debug="${debug}" deprecation="${deprecation}"
             fork="yes" memoryMaximumSize="256m"
             source="1.5" target="1.5">
         <include name="weka/**/*"/>

         <classpath refid="project.class.path" />
         <classpath>
            <pathelement path="${java.class.path}" />
            <pathelement location="." />
         </classpath>
      </javac>
   </target>

   <!-- retroweaver -->
   <target name="retroweave">
      <retroweaver srcdir="${build}" destdir="${retro}"/>
   </target>

   <!-- dist -->
   <target name="dist" depends="init, removeJar, compile, retroweave" description="Generates the jar archive.">
      <jar jarfile="${dist}/weka.jar">
         <fileset dir="${retro}">
            <include name="*" />
            <include name="weka/**/*" />
         </fileset>

         <manifest>
            <attribute name="Built-By"   value="${user.name}"/>
            <attribute name="Main-Class" value="weka.gui.GUIChooser"/>
         </manifest>
      </jar>
   </target>

   <!-- src-targz -->
   <target name="tar" depends="dist" description="Generates are gzipped tar from the source code.">
     <tar destfile="${dist}/weka-src.tgz"
          basedir="${src}"
          includes="weka/**/*"
          compression="gzip"/>
   </target>
</project>
